@model PopupCreateViewModel
@{
    ViewData["Title"] = "Create Popup";
    var popupTypeName = Model.Type.ToString();
    Layout = null; // Don't use the default layout to avoid Tailwind conflicts
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Popup Manager Pro</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .navbar-brand {
            font-weight: 600;
            font-size: 1.25rem;
        }
    </style>
</head>
<body>
    <!-- Simple Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand" href="/Popup">
                <i class="bi bi-window"></i> Popup Manager Pro
            </a>
            <div class="ms-auto">
                <a href="/Popup" class="btn btn-outline-light btn-sm">
                    <i class="bi bi-arrow-left"></i> Back to Popups
                </a>
            </div>
        </div>
    </nav>

<div class="container mt-5 mb-5">
    <!-- Header -->
    <div class="mb-4">
        <h1 class="display-4">Create @popupTypeName Popup</h1>
        <p class="lead">Configure your popup settings and customize the appearance</p>
    </div>

    <form asp-action="Create" method="post">
        <input type="hidden" asp-for="Type" />
        <input type="hidden" asp-for="TypeSpecificOptions" id="typeSpecificOptionsInput" />
        
        <!-- Basic Information -->
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h3 class="mb-0"><i class="bi bi-info-circle"></i> Basic Information</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label asp-for="Name" class="form-label">Popup Name</label>
                    <input asp-for="Name" class="form-control" placeholder="Enter a descriptive name" />
                    <span asp-validation-for="Name" class="text-danger"></span>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label asp-for="Title" class="form-label">Title</label>
                        <input asp-for="Title" class="form-control" placeholder="Main heading" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label asp-for="Subtitle" class="form-label">Subtitle</label>
                        <input asp-for="Subtitle" class="form-control" placeholder="Sub-heading text" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Type-Specific Options -->
        <div class="card mb-4" id="typeSpecificOptionsCard">
            <div class="card-header bg-success text-white">
                <h3 class="mb-0"><i class="bi bi-sliders"></i> @popupTypeName Options</h3>
            </div>
            <div class="card-body" id="typeSpecificOptionsContent">
                <!-- Content will be dynamically loaded based on popup type -->
            </div>
        </div>

        <!-- Targeting & Behavior -->
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h3 class="mb-0"><i class="bi bi-gear"></i> Targeting & Behavior</h3>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label asp-for="Trigger" class="form-label">Trigger</label>
                        <select asp-for="Trigger" class="form-select">
                            <option value="OnPageLoad">On Page Load</option>
                            <option value="OnExitIntent">Exit Intent</option>
                            <option value="OnScroll">On Scroll</option>
                            <option value="OnTimeDelay">Time Delay</option>
                            <option value="OnClick">On Click</option>
                            <option value="OnIdle">On Idle</option>
                        </select>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label asp-for="DelayMs" class="form-label">Delay</label>
                        <div class="input-group">
                            <input asp-for="DelayMs" type="number" class="form-control" min="0" max="60000" step="1000" id="delayInput" />
                            <span class="input-group-text">ms</span>
                        </div>
                        <small class="text-muted" id="delayHelp">0 = immediate, 3000 = 3 seconds</small>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label asp-for="Frequency" class="form-label">Frequency</label>
                        <select asp-for="Frequency" class="form-select">
                            <option value="EveryVisit">Every Visit</option>
                            <option value="OncePerSession">Once Per Session</option>
                            <option value="OncePerDay">Once Per Day</option>
                            <option value="OncePerWeek">Once Per Week</option>
                            <option value="OncePerMonth">Once Per Month</option>
                            <option value="OnceEver">Once Ever</option>
                        </select>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Device Targeting</label>
                    <div class="form-check">
                        <input asp-for="ShowOnDesktop" class="form-check-input" type="checkbox" />
                        <label asp-for="ShowOnDesktop" class="form-check-label">Show on Desktop</label>
                    </div>
                    <div class="form-check">
                        <input asp-for="ShowOnMobile" class="form-check-input" type="checkbox" />
                        <label asp-for="ShowOnMobile" class="form-check-label">Show on Mobile</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="d-flex justify-content-between mb-5">
            <a asp-action="Index" class="btn btn-outline-secondary btn-lg">
                <i class="bi bi-arrow-left"></i> Cancel
            </a>
            <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-circle"></i> Create Popup
            </button>
        </div>

        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>

<script>
        // Type-specific options templates
        const typeOptionsTemplates = {
            EmailCollector: `
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Heading</label>
                        <input type="text" class="form-control" id="heading" value="Subscribe to Our Newsletter" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Button Text</label>
                        <input type="text" class="form-control" id="buttonText" value="Subscribe Now" />
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Sub-heading</label>
                        <input type="text" class="form-control" id="subHeading" value="Get the latest updates" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="collectName" checked />
                            <label class="form-check-label" for="collectName">Collect Name</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="collectPhone" />
                            <label class="form-check-label" for="collectPhone">Collect Phone</label>
                        </div>
                    </div>
                </div>
            `,
            Advertising: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Heading</label>
                        <input type="text" class="form-control" id="heading" value="Special Offer!" />
                    </div>
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Sub-heading</label>
                        <input type="text" class="form-control" id="subHeading" value="Limited time only" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Button Text</label>
                        <input type="text" class="form-control" id="buttonText" value="Shop Now" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Button URL</label>
                        <input type="text" class="form-control" id="buttonUrl" placeholder="/shop" />
                    </div>
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showCountdown" />
                            <label class="form-check-label" for="showCountdown">Show Countdown Timer</label>
                        </div>
                    </div>
                </div>
            `,
            Coupon: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Heading</label>
                        <input type="text" class="form-control" id="heading" value="Exclusive Discount!" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Coupon Code</label>
                        <input type="text" class="form-control" id="couponCode" placeholder="SAVE20" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Discount Value</label>
                        <input type="text" class="form-control" id="discountValue" value="20% OFF" />
                    </div>
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="requireEmail" checked />
                            <label class="form-check-label" for="requireEmail">Require Email to View Code</label>
                        </div>
                    </div>
                </div>
            `,
            VideoPopup: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Video URL</label>
                        <input type="text" class="form-control" id="videoUrl" placeholder="https://www.youtube.com/embed/..." />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Video Provider</label>
                        <select class="form-select" id="videoProvider">
                            <option value="youtube">YouTube</option>
                            <option value="vimeo">Vimeo</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check mt-4">
                            <input class="form-check-input" type="checkbox" id="autoPlay" checked />
                            <label class="form-check-label" for="autoPlay">Auto Play</label>
                        </div>
                    </div>
                </div>
            `,
            SpinWheel: `
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> Spin Wheel configuration requires advanced settings. Basic setup will be created.
                </div>
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Heading</label>
                        <input type="text" class="form-control" id="heading" value="Spin to Win!" />
                    </div>
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="requireEmail" checked />
                            <label class="form-check-label" for="requireEmail">Require Email Before Spin</label>
                        </div>
                    </div>
                </div>
            `,
            Message: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Message</label>
                        <textarea class="form-control" id="message" rows="2" placeholder="Your notification message"></textarea>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Message Type</label>
                        <select class="form-select" id="messageType">
                            <option value="info">Info</option>
                            <option value="success">Success</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Position</label>
                        <select class="form-select" id="position">
                            <option value="top-right">Top Right</option>
                            <option value="top-left">Top Left</option>
                            <option value="bottom-right">Bottom Right</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="top-center">Top Center</option>
                            <option value="bottom-center">Bottom Center</option>
                        </select>
                    </div>
                </div>
            `,
            Lightbox: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Image URL</label>
                        <input type="text" class="form-control" id="imageUrl" placeholder="/images/hero.jpg" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="showCloseButton" checked />
                            <label class="form-check-label" for="showCloseButton">Show Close Button</label>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="closeOnBackdropClick" checked />
                            <label class="form-check-label" for="closeOnBackdropClick">Close on Backdrop Click</label>
                        </div>
                    </div>
                </div>
            `,
            Inline: `
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <label class="form-label">Content HTML</label>
                        <textarea class="form-control" id="content" rows="3" placeholder="<div>Your inline content here</div>"></textarea>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Position</label>
                        <select class="form-select" id="position">
                            <option value="afterParagraph">After Paragraph</option>
                            <option value="beforeParagraph">Before Paragraph</option>
                            <option value="custom">Custom Selector</option>
                        </select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label">Paragraph Number</label>
                        <input type="number" class="form-control" id="paragraphNumber" value="2" min="1" />
                    </div>
                </div>
            `
        };

        // Load type-specific options based on popup type
        document.addEventListener('DOMContentLoaded', function() {
            const popupType = '@Model.Type';
            loadTypeSpecificOptions(popupType);
        });

        function loadTypeSpecificOptions(type) {
            const container = document.getElementById('typeSpecificOptionsContent');
            if (typeOptionsTemplates[type]) {
                container.innerHTML = typeOptionsTemplates[type];
            } else {
                container.innerHTML = '<p class="text-muted">No additional options for this type.</p>';
            }
        }

        // Before form submit, collect type-specific options
        document.querySelector('form').addEventListener('submit', function(e) {
            const popupType = '@Model.Type';
            const options = {};
            
            // Collect all input values from type-specific options
            const container = document.getElementById('typeSpecificOptionsContent');
            const inputs = container.querySelectorAll('input, select, textarea');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    options[input.id] = input.checked;
                } else {
                    options[input.id] = input.value;
                }
            });
            
            document.getElementById('typeSpecificOptionsInput').value = JSON.stringify(options);
        });

        // Helper to show delay in seconds
        const delayInput = document.getElementById('delayInput');
        const delayHelp = document.getElementById('delayHelp');
        
        if (delayInput && delayHelp) {
            delayInput.addEventListener('input', function() {
                const ms = parseInt(this.value) || 0;
                const seconds = (ms / 1000).toFixed(1);
                if (ms === 0) {
                    delayHelp.textContent = 'Immediate (no delay)';
                } else if (ms < 1000) {
                    delayHelp.textContent = `${ms}ms`;
                } else {
                    delayHelp.textContent = `${seconds} seconds (${ms}ms)`;
                }
            });
            
            // Trigger on load
            delayInput.dispatchEvent(new Event('input'));
        }
    </script>
</body>
</html>
